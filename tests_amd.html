<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <title>Tests</title>
  <meta http-equiv="content-type" content="text/html;charset=utf-8" />
  <link rel="stylesheet" href="bower_components/mocha/mocha.css" />
  <link rel="stylesheet" href="bower_components/mocha-screencast-reporter/screencast-reporter.css" />
</head>
<body>
  <div id="mocha"></div>
  <script type="text/javascript" src="bower_components/expect/index.js"></script>
  <script type="text/javascript" src="bower_components/mocha-screencast-reporter/screencast-reporter.js"></script>
  <script type="text/javascript" src="bower_components/mocha/mocha.js"></script>

  <script type="text/javascript" src="bower_components/requirejs/require.js"></script>
  <script type="text/javascript">
    // track test modules
    var testModules = [],
        requireJsDefine = define;
    define = function() {
      requireJsDefine.apply(this, arguments);
      if(arguments.length > 0 && typeof arguments[0] === 'string' && arguments[0].match(/^.*\/test\/.*_test$/)){
        testModules.push(arguments[0]);
      }
    };
    // copy attributes of new define
    for (var attr in requireJsDefine){
      if (requireJsDefine.hasOwnProperty(attr)) {
        define[attr] = requireJsDefine[attr];
      }
    }

    // tiny shim
    define('expect',[],function(){
      return expect;
    });
  </script>

  <script type="text/javascript" src="/char-buffer.amd.js"></script>
  <script type="text/javascript" src="/char-buffer.amd_tests.js"></script>

  <script>
  // init mocha
  mocha.setup({ ui: 'bdd' });
  mocha.reporter(ScreencastReporter);

  // run tests
  require(testModules, function(){
    var runner = mocha.run();

    // check if ended (with sauce labs issues)
    var count = 5,
        check = setInterval(function(){
      if (runner.stats.end) {
        window.mochaResults = runner.stats;
        if(count>0){
          count--;
        }else{
          clearInterval(check);
        }
      }
    }, 1000);
  });
  </script>
</body>
</html>
